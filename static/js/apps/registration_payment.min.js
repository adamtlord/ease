$(function(){var e=function(){$.ajax({url:"/concierge/billing/retrieve_coupon/",data:{coupon_code:$("#id_coupon").val()},beforeSend:function(){$("#apply_coupon").addClass("loading"),$("#coupon_form_group .coupon-validation").removeClass("alert alert-danger alert-success").text("")}}).done(function(e){$("#apply_coupon").removeClass("loading"),e.success?$("#coupon_form_group .coupon-validation").addClass("alert alert-success").html("<strong>Coupon accepted!</strong><br>The coupon you entered will reduce your first invoice by $"+parseFloat(e.stripe_coupon.amount_off/100).toFixed(2)):$("#coupon_form_group .coupon-validation").addClass("alert alert-danger").text(e.message)})};$("#user_form").submit(function(){if($("#add_card").is(":visible")){var e=this,r={number:$("#credit_card_number").val(),expMonth:$("#expiry_month").val(),expYear:$("#expiry_year").val(),cvc:$("#cvv").val(),address_zip:$("#id_billing_zip").val()};return Stripe.createToken(r,function(r,o){200===r?($("#credit-card-errors").hide(),$("#id_last_4_digits").val(o.card.last4),$("#stripe_token").val(o.id),e.submit()):($("#stripe-error-message").text(o.error.message),$("#credit-card-errors").show(),$("#user_submit").attr("disabled",!1))}),!1}return!0}),$("#apply_coupon").click(function(){e()}),$("#id_coupon").blur(function(){this.value.length&&e()}),$("#change_card").click(function(){return $("#card_on_file").hide(),$("#add_card").show(),$("#credit_card_number").focus(),!1}),$("#cancel_change_card").click(function(){return $("#add_card").hide(),$("#card_on_file").show(),!1}),$("#change_ride_card").click(function(){$("#add_ride_card").show(),$("#add_stripe_customer").val(1),$("#id_first_name").focus()}),$("#change_plan").click(function(){$("#selected_plan").hide(),$(".plan-buttons").show()}),$(".cc-mask input").mask("0000-0000-0000-0000"),$(".zip-mask input").mask("00000-0000"),$("#credit-card-errors").is(":visible")&&$("html, body").animate({scrollTop:$("#credit-card-errors").offset().top-40},500)});