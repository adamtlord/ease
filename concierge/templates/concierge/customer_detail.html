{% extends 'concierge/customer_base.html' %}
{% load map_tags %}

{% block customer_content %}
{% if rides_in_progress %}
<div class="rides-in-progress">
<h3>Rides in Progress</h3>
<table class="table">
    <thead>
        <tr>
            <th>From</th>
            <th>To</th>
            <th>Started</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for ride in rides_in_progress %}
        <tr>
            <td>{{ ride.start.display_name }}</td>
            <td>{{ ride.destination.display_name }}</td>
            <td>{{ ride.start_date }}</td>
            <td><a href="{% url 'ride_end' customer.id ride.id %}" class="btn btn-danger">End Ride</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endif %}
    <div class="row">
        <div class="col-sm-8">
            <table class="table">
                <tbody>
                    <tr>
                        <td>{% if customer.known_as %}"{{ customer.known_as }}"{% endif %}</td>
                        <td>
                            {% if customer.dob %}
                                Age {{ customer.age }}
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {{ customer.home.street1 }}<br>
                            {% if customer.home.street2 %}
                                {{ customer.home.street2 }}<br>
                            {% endif %}
                            {{ customer.home.city }},
                            {{ customer.home.state }}
                            {{ customer.home.zip_code }}
                        </td>
                        <td>
                            {% if customer.residence_type %}
                                <span class="label label-default">
                                    {{ customer.get_residence_type_display }}
                                </span>
                            {% endif %}
                            {% if customer.residence_instructions %}
                                <p>Residence Instructions: {{ customer.residence_instructions }}</p>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {% if customer.home_phone %}
                                {{ customer.home_phone }} (H){% if customer.preferred_phone == 'h' %} <i class="fa fa-check text-success"></i> {% endif %}<br>
                            {% endif %}
                            {% if customer.mobile_phone %}
                                {{ customer.mobile_phone }} (M){% if customer.preferred_phone == 'm' %} <i class="fa fa-check text-success"></i> {% endif %}<br>
                            {% endif %}
                        </td>
                        <td>
                            <a href="mailto:{{ customer.email }}">{{ customer.email }}</a>
                        </td>
                    </tr>
                    {% if riders %}
                        <tr>
                            <td>Riders:</td>
                            <td>
                                <ul>
                                    {% for rider in riders %}
                                        <li>{{ rider.first_name }} {{ rider.last_name }}</li>
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        <div class="col-sm-4">
            <a href="{% url 'ride_start' customer.id %}" class="btn btn-success btn-block btn-lg">
                Start a New Ride
            </a>
        </div>
    </div>
{% if not customer.destinations %}
    <p class="alert alert-warning">No destinations entered for this customer!</p>
{% endif %}

{% endblock %}