$(function(){var e=function(){$("#plan_charges").removeClass("plan1 plan2 plan3"),$("#plan_charges").addClass("plan"+$("input[name=plan]:checked").val())},n=function(){$.ajax({url:"/billing/retrieve_coupon/",data:{coupon_code:$("#id_coupon").val()},beforeSend:function(){$("#apply_coupon").addClass("loading"),$("#coupon_form_group .help-block").text("")}}).done(function(e){$("#apply_coupon").removeClass("loading"),e.success?($("#coupon_form_group .help-block").text("Valid coupon!"),$("#plan_charges").addClass("coupon").find(".coupon").html("The coupon you entered will reduce your first invoice by $"+parseFloat(e.stripe_coupon.amount_off/100).toFixed(2))):$("#coupon_form_group .help-block").text(e.message)})};$("#user_form").submit(function(){if($("#add_card").is(":visible")){var e=this,n={number:$("#credit_card_number").val(),expMonth:$("#expiry_month").val(),expYear:$("#expiry_year").val(),cvc:$("#cvv").val(),address_zip:$("#id_billing_zip").val()};return Stripe.createToken(n,function(n,a){200===n?($("#credit-card-errors").hide(),$("#id_last_4_digits").val(a.card.last4),$("#stripe_token").val(a.id),e.submit()):($("#stripe-error-message").text(a.error.message),$("#credit-card-errors").show(),$("#user_submit").attr("disabled",!1))}),!1}return!0}),$("#apply_coupon").click(function(){n()}),$("#id_coupon").blur(function(){this.value.length&&n()}),$("#change_card").click(function(){return $("#card_on_file").hide(),$("#add_card").show(),$("#credit_card_number").focus(),!1}),$("#cancel_change_card").click(function(){return $("#add_card").hide(),$("#card_on_file").show(),!1}),$("#change_ride_card").click(function(){$("#add_ride_card").show(),$("#add_stripe_customer").val(1),$("#id_first_name").focus()}),$("#change_plan").click(function(){$("#selected_plan").hide(),$(".plan-buttons").show()}),$(".cc-mask input").mask("0000-0000-0000-0000"),$(".zip-mask input").mask("00000-0000"),$("input[name=plan]").change(function(){e()}),e()});